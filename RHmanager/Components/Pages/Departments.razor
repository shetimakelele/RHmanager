@page "/departments"
@rendermode InteractiveServer
@inject IDepartmentService DepartmentService
@inject NavigationManager Navigation

<PageTitle>Départements - RH Manager</PageTitle>

<div class="container-fluid mt-4">
    
    <!-- En-tête avec bouton ajouter -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="display-6">Gestion des départements</h1>
        <button class="btn btn-outline-primary" @onclick="OpenCreateModal">
            <i class="bi bi-plus-circle"></i> Nouveau département
        </button>
    </div>

    @if (isLoading)
    {
        <!-- Spinner de chargement -->
        <div class="text-center my-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Chargement...</span>
            </div>
        </div>
    }
    else if (!departments.Any())
    {
        <!-- Message si vide -->
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> Aucun département enregistré.
        </div>
    }
    else
    {
        <!-- Tableau des départements -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Nom</th>
                                <th>Description</th>
                                <th class="text-center">Employés</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var dept in departments)
                            {
                                <tr>
                                    <td>
                                        <strong>@dept.Name</strong>
                                    </td>
                                    <td>
                                        @(string.IsNullOrEmpty(dept.Description) ? "-" : dept.Description)
                                    </td>
                                    <td class="text-center">
                                        <span class="badge bg-primary rounded-pill">
                                            @dept.Employees.Count
                                        </span>
                                    </td>
                                    <td class="text-end">
                                        <button class="btn btn-sm btn-outline-primary me-1" 
                                                @onclick="() => OpenEditModal(dept)">
                                            <i class="bi bi-pencil"></i> Modifier
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" 
                                                @onclick="() => DeleteDepartment(dept)"
                                                disabled="@(dept.Employees.Count > 0)">
                                            <i class="bi bi-trash"></i> Supprimer
                                        </button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }

    <!-- Message de succès/erreur avec le composant réutilisable -->
    <AlertMessage MessageHelper="messageHelper" />

</div>